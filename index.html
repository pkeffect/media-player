<!-- VERSION: 9.2.0 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Internode Media Player</title>
    <meta name="description" content="Professional browser-based media player with 12-band EQ and HLS support.">
    
    <!-- iOS/Safari PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Internode">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Theme Color for browser chrome -->
    <meta name="theme-color" content="#1a1a2e">
    
    <!-- Prevent phone number detection -->
    <meta name="format-detection" content="telephone=no">
    
    <!-- PERFORMANCE: Preconnect for CDNs -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <link rel="stylesheet" href="css/base.css">
    
    <!-- REPLACED components.css with new logical split -->
    <link rel="stylesheet" href="css/ui-base.css">
    <link rel="stylesheet" href="css/modals-core.css">
    <link rel="stylesheet" href="css/modal-eq.css">
    <link rel="stylesheet" href="css/modal-readme.css">
    <link rel="stylesheet" href="css/menubar.css">
    
    <link rel="stylesheet" href="css/player.css">
    <link rel="stylesheet" href="css/sidebar.css">
    
    <!-- Libraries -->
    <!-- SECURE: Added Subresource Integrity (SRI) Hash for Security -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest/dist/hls.min.js" crossorigin="anonymous"></script>
    <!-- LOCAL JSMEDIATAGS -->
    <script src="js/jsmediatags.min.js"></script>
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Touch Icon -->
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <style>
        /* Loading Overlay */
        #app-loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0a0a0a; z-index: 99999; display: flex;
            justify-content: center; align-items: center; color: #fff;
            transition: opacity 0.5s ease;
        }
        /* Skip Link for Accessibility */
        .skip-link {
            position: absolute; top: -40px; left: 0; background: #e50914; color: white;
            padding: 8px; z-index: 100000; transition: top 0.2s;
        }
        .skip-link:focus { top: 0; }
        /* Offline Indicator */
        #offline-indicator {
            display: none; position: fixed; bottom: 10px; right: 10px;
            background: #e53935; color: white; padding: 4px 8px;
            border-radius: 4px; font-size: 0.8rem; z-index: 10000;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <a href="#main-video" class="skip-link">Skip to Player</a>
    
    <div id="app-loader">
        <svg width="50" height="50" viewBox="0 0 50 50">
            <path fill="#fff" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z">
                <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"/>
            </path>
        </svg>
    </div>
    
    <!-- FAILSAFE: Remove loader if JS crashes or stalls -->
    <script>
        setTimeout(() => {
            const l = document.getElementById('app-loader');
            if(l) { 
                console.warn('App took too long to load. Removing spinner.');
                l.style.opacity = '0';
                setTimeout(() => l.remove(), 500); 
            }
        }, 4000);
    </script>
    
    <div id="offline-indicator">OFFLINE</div>

    <!-- Loaded dynamically: menubar.html -->

    <div id="app-layout">
        <!-- Main Player Section -->
        <div id="player-stage">
            <!-- playsinline is critical for iOS inline video playback -->
            <video id="main-video" crossorigin="anonymous" playsinline webkit-playsinline></video>
            
            <div id="subtitle-overlay"></div>

            <!-- NEW: Center Status Icon (Pause) -->
            <div id="center-icon">
                <svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            </div>

            <div id="drop-overlay">
                <div class="drop-message">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" aria-hidden="true">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    <span>Drop Media or Subtitles</span>
                </div>
            </div>

            <div id="notification-toast" role="alert" aria-live="polite"></div>

            <!-- Double Click Animations -->
            <div class="seek-anim left" id="anim-rewind" aria-hidden="true">
                <svg viewBox="0 0 24 24"><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/></svg>
                <span>-10s</span>
            </div>
            <div class="seek-anim right" id="anim-forward" aria-hidden="true">
                <svg viewBox="0 0 24 24"><path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"/></svg>
                <span>+10s</span>
            </div>

            <!-- Mobile Only Playlist Toggle -->
            <button id="mobile-playlist-toggle" title="Open Playlist" aria-label="Open Playlist">
                <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>
            </button>

            <div class="controls-wrapper">
                <div class="progress-area" id="seek-container" role="slider" aria-label="Seek Video" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                    <div class="progress-bg"></div>
                    <div class="progress-fill" id="seek-fill"></div>
                    <div class="progress-thumb" id="seek-thumb"></div>
                </div>

                <div class="buttons-row">
                    <div class="left-group">
                        <button id="btn-prev" class="icon-btn" title="Previous Track" aria-label="Previous Track"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg></button>
                        <button id="btn-play" class="icon-btn" title="Play or Pause" aria-label="Play or Pause">
                            <svg class="icon-play" viewBox="0 0 24 24" aria-hidden="true"><path d="M8 5v14l11-7z"/></svg>
                            <svg class="icon-pause" viewBox="0 0 24 24" style="display:none" aria-hidden="true"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                        </button>
                        <button id="btn-next" class="icon-btn" title="Next Track" aria-label="Next Track"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg></button>
                        
                        <!-- FRAME ADVANCE BUTTONS (Always Visible) -->
                        <button id="btn-frame-prev" class="icon-btn small" title="Previous Frame" aria-label="Previous Frame">
                            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M18 16.88L13.13 12 18 7.12v9.76z M8 7v10h2V7H8z"/></svg>
                        </button>
                        <button id="btn-frame-next" class="icon-btn small" title="Next Frame" aria-label="Next Frame">
                            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 16.88L10.87 12 6 7.12v9.76z M14 7v10h2V7h-2z"/></svg>
                        </button>

                        <div class="volume-container">
                            <button id="btn-mute" class="icon-btn small" title="Mute" aria-label="Mute or Unmute">
                                <svg class="icon-vol-up" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                                <svg class="icon-vol-off" viewBox="0 0 24 24" style="display:none" aria-hidden="true"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>
                            </button>
                            <input type="range" id="volume-slider" min="0" max="1" step="0.05" value="1" aria-label="Volume Level">
                        </div>
                        <div id="time-display" aria-label="Playback Time">00:00 / 00:00</div>

                        <div class="select-wrapper">
                            <select id="playback-rate" aria-label="Playback Speed">
                                <option value="0.25">0.25x</option>
                                <option value="0.5">0.5x</option>
                                <option value="1" selected>1.0x</option>
                                <option value="1.25">1.25x</option>
                                <option value="1.5">1.5x</option>
                                <option value="2">2.0x</option>
                                <option value="3">3.0x</option>
                                <option value="4">4.0x</option>
                            </select>
                        </div>
                    </div>
                    <div class="right-group">
                        
                        <button id="btn-screenshot" class="icon-btn" title="Take Screenshot" aria-label="Take Screenshot">
                            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 12m-3.2 0a3.2 3.2 0 1 0 6.4 0a3.2 3.2 0 1 0 -6.4 0 M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9z"/></svg>
                        </button>

                        <button id="btn-stream" class="icon-btn" title="Open Stream" aria-label="Open Network Stream">
                            <svg class="globe-svg" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                <defs>
                                    <clipPath id="globe-mask"><circle cx="12" cy="12" r="10" /></clipPath>
                                    <radialGradient id="globe-shine" cx="30%" cy="30%" r="70%">
                                        <stop offset="0%" stop-color="rgba(255,255,255,0.4)" />
                                        <stop offset="100%" stop-color="rgba(0,0,0,0.1)" />
                                    </radialGradient>
                                </defs>
                                <circle cx="12" cy="12" r="10" class="globe-ocean" fill="#2962ff" />
                                <g clip-path="url(#globe-mask)">
                                    <g class="globe-map">
                                        <path d="M2,12 Q5,6 10,10 T16,14 T22,10 M26,12 Q29,6 34,10 T40,14 T46,10" stroke="#4caf50" stroke-width="6" stroke-linecap="round" fill="none" class="globe-land" />
                                        <path d="M5,18 Q8,15 12,17 T18,16 M29,18 Q32,15 36,17 T42,16" stroke="#4caf50" stroke-width="4" stroke-linecap="round" fill="none" class="globe-land" />
                                        <path d="M4,6 Q8,4 12,5 T19,6 M28,6 Q32,4 36,5 T43,6" stroke="#4caf50" stroke-width="3" stroke-linecap="round" fill="none" class="globe-land" />
                                    </g>
                                </g>
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" stroke-opacity="0.5" fill="url(#globe-shine)"/>
                            </svg>
                        </button>

                        <button id="btn-eq" class="icon-btn" title="Equalizer" aria-label="Toggle Equalizer">
                            <svg viewBox="0 0 24 24" class="eq-icon-svg" aria-hidden="true">
                                <defs>
                                    <linearGradient id="eq-led-gradient" x1="0" x2="0" y1="1" y2="0">
                                        <stop offset="0%" stop-color="#4caf50"/>
                                        <stop offset="50%" stop-color="#ffeb3b"/>
                                        <stop offset="100%" stop-color="#f44336"/>
                                    </linearGradient>
                                </defs>
                                <rect class="eq-bar eq-bar-1" x="4" y="12" width="4" height="8" rx="1" fill="url(#eq-led-gradient)" />
                                <rect class="eq-bar eq-bar-2" x="10" y="8" width="4" height="12" rx="1" fill="url(#eq-led-gradient)" />
                                <rect class="eq-bar eq-bar-3" x="16" y="14" width="4" height="6" rx="1" fill="url(#eq-led-gradient)" />
                            </svg>
                        </button>
                        <button id="btn-subs" class="icon-btn" title="Toggle Subtitles (Right-Click for Settings)" aria-label="Toggle Subtitles">
                            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                        </button>
                        <button id="btn-pip" class="icon-btn" title="Picture in Picture" aria-label="Picture in Picture"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M19 11h-8v6h8v-6zm4 8V4.98C23 3.88 22.1 3 21 3H3c-1.1 0-2 .88-2 1.98V19c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H3V4.97h18v14.05z"/></svg></button>
                        <button id="btn-fullscreen" class="icon-btn" title="Fullscreen" aria-label="Fullscreen"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg></button>
                        
                        <!-- INFO BUTTON -->
                        <button id="btn-readme" class="icon-btn" title="Project Info" aria-label="Project Information">
                            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                        </button>

                        <button id="btn-toggle-playlist" class="icon-btn active" title="Playlist" aria-label="Toggle Playlist Sidebar"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Playlist Sidebar (Loaded Dynamically) -->
        <!-- EQ Modal (Loaded Dynamically) -->
        <!-- Info Modal (Loaded Dynamically) -->

    </div>

    <!-- Loaded dynamically: stream.html -->
    <!-- Loaded dynamically: captions.html -->

    <div id="context-menu" role="menu">
        <div class="menu-item" id="ctx-move-up" role="menuitem">
            <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true"><path d="M7 14l5-5 5 5H7z"/></svg>
            Move Up
        </div>
        <div class="menu-item" id="ctx-move-down" role="menuitem">
            <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true"><path d="M7 10l5 5 5-5H7z"/></svg>
            Move Down
        </div>
        <div class="menu-item" id="ctx-open-folder" role="menuitem">
            <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true"><path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>
            Open Folder
        </div>
        <div class="menu-item" id="ctx-remove" role="menuitem">
            <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
            Remove
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>